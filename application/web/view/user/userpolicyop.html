<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title>保单操作</title>
    <link rel="stylesheet" href="__STATIC__/web/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/web/css/font/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/web/css/lib.css">
    <link rel="stylesheet" href="__STATIC__/web/css/swiper.min.css">
    <link rel="stylesheet" href="__STATIC__/web/css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/web/css/style.css">
    <script src="__STATIC__/web/js/jquery.min_1.11.1.js"></script>
    <script src="__STATIC__/web/js/bootstrap.min.js"></script>
    <script src="__STATIC__/web/js/swiper.min.js"></script>
    <script src="__STATIC__/web/js/swiper.animate.min.js"></script>
    <script type="text/javascript" src="__STATIC__/web/js/org.min.js" data-main="indexMain"></script>
    <style>
    .step{display:none;}
    </style>
</head>

<body>
    {include file="/index/head"}
    <div id="newsPage" class="npagePage Pagenews">
        <div id="banner">
            <div style="background-image:url(http://resources.jsmo.xin/templates/upload/4101/201709/1505124501768.jpg);"></div>
        </div>
        <div class="content">
            <div class="header">
                <a href="usercenter.html">
                    <p class="title">我的账户</p>
                    <p class="subtitle">My account</p>
                </a>
            </div>
            <div id="category">
                <a href="/web/user/capital" {if $action eq "capital"}class="active"{/if}>资金管理</a>
                <a href="/web/user/agentorder" {if $action eq "agentorder"}class="active"{/if}>商户预约</a>
                <a href="/web/user/order" {if $action eq "orderdetail"}class="active"{/if}>我的保单</a>
                <!-- <a href="/web/user/bill" {if $action eq "bill"}class="active"{/if}>我的账单</a> -->
                <a href="/web/user/info" {if $action eq "info"}class="active"{/if}>个人资料</a>
                <a href="/web/user/security" {if $action eq "security"}class="active"{/if}>账户安全</a>
                <!-- <a href="/web/user/award" {if $action eq "award"}class="active"{/if}>推广奖励</a> -->
            </div>
            <div id="newslist" class="rightcon">
                <div class="wrapper usermsg policy">
                    <div class="black">
                        确认保单信息
                    </div>
                    <div class="table-responsive">
                        
                        <form id="orderform"  method="post">
                        <table class="table">
                            <tbody>
                                <tr class="orange">
                                    <td class="text-left" colspan="2">保单信息</td>
                                </tr>
                            </tbody>
                            <tbody>
                                <tr class="gray gray-2">
                                    <td class="text-left fw1">订单编号</td>
                                    <td class="text-left"><font id="ordernum"></font></td>
                                </tr>
                                <tr class="gray gray-2">
                                    <td class="text-left fw1">订单时间</td>
                                    <td class="text-left"><font id="ordertime"></font></td>
                                </tr>
                                <tr class="gray gray-2">
                                    <td class="text-left fw1">被保车辆</td>
                                    <td class="text-left"><font id="car_license"></font></td>
                                </tr>
                                <tr class="gray gray-2">
                                    <td class="text-left fw1">车主姓名</td>
                                    <td class="text-left"><font id="car_name"></font></td>
                                </tr>
                                <tr class="gray gray-2">
                                    <td class="text-left fw1">身份证</td>
                                    <td class="text-left"><font id="id_code"></font></td>
                                </tr>
                                <tr class="gray gray-2">
                                    <td class="text-left fw1">行驶证</td>
                                    <td class="text-left"><font id="car_code"></font></td>
                                </tr>
                                 <!--<tr class="gray gray-2">
                                    <td class="text-left fw1">投保公司</td>
                                    <td class="text-left"><font id="companyname"></font></td>
                                </tr>
                                <tr class="gray gray-2 white">
                                    <td class="text-left fw1">投保险种</td>
                                    <td class="text-left">
                                        交强险、车船
                                        <br>第三者险 30万
                                        <br>车损险
                                        <br>自燃险
                                        <br>盗抢险　(不计免赔)
                                    </td>
                                </tr> -->
                                <tr class="gray gray-2">
                                    <td class="text-left fw1">保单报价
                                        <br>(元人民币)</td>
                                    <td class="text-left">
                                            <font id="orderid" value="{id}" style="display:none;"></font>
                                            <font id="nowqishu" style="display:none;"></font>
                                        交强险 ￥<font id="jqprice"></font>
                                        <br> 车船税 ￥<font id="csprice"></font>
                                        <br> 商业险 ￥<font id="syprice"></font>
                                        <br>
                                        <span>合计 <span class="small">￥</span><font id="order_price"></font></span>
                                    </td>
                                </tr>
                                
                                <!-- <tr class="gray gray-2 step2">
                                    <td class="text-left fw1">商业险分期数</td>
                                    <td class="text-left"><font id="install_count"></font></td>
                                </tr> -->
                                <tr class="gray gray-2 step step3">
                                    <td class="text-left fw1">分期</td>
                                    <td class="text-left">
                                        <div class="aui-grid-label aui-text-left">
                                            <div>
                                                <input class="aui-checkbox aui-fq aui-checked" type="radio" name="install_count" value="3" checked=""> 3期&emsp;（每期：￥
                                                <font id="install_3"></font>）
                                            </div>
                                            <div>
                                                <input class="aui-checkbox aui-fq" type="radio" name="install_count" value="6"> 6期&emsp;（每期：￥
                                                <font id="install_6"></font>）
                                            </div>
                                            <div>
                                                <input class="aui-checkbox aui-fq" type="radio" name="install_count" value="9"> 9期&emsp;（每期：￥
                                                <font id="install_9"></font>）
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="gray gray-2 step step3">
                                    <td colspan="2">
                                        <div class="selyuyue" style="padding:0px; margin:0px;">
                                            <button class="btn" type="button"  onclick="createorder()">确认分期</button>
                                        </div>
                                    </td>
                                </tr>
								
                                <tr class=" gray gray-2 step step0" >
                                    <td colspan="2">
                                        <div class="selyuyue" style="padding:0px; margin:0px;">
                                            <button class="btn pay" type="button" >全款支付</button>
                                            <button class="btn install" type="button">分期支付</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class=" gray gray-2 step offer" >
                                    <td colspan="2">
                                        <div class="selyuyue" style="padding:0px; margin:0px;">
                                            <button class="btn next" style="background:#dddddd;" type="button" >等待报价</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        </form>
                    </div>
                    {if $install}
                    <div class="black">
                        账单列表
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <tbody>
                                <tr class="orange">
                                    <td>选择</td>
                                    <td>期数</td>
                                    <td>截止付款日期</td>
                                    <td>期初余额</td>
                                    <td>还款金额</td>
                                    <td>期末余额</td>
                                    <td>支付时间</td>
                                </tr>
                            </tbody>
                            <tbody>
                                {volist name="install" id="vo" key="k"}
                                <tr class="gray gray-2">
                                    <td>
                                    {if !$vo.paystat}
                                    <input type="checkbox" class="qishu" value="{$vo.qishu}">
                                    {else}
                                    <input type="checkbox" disabled="true">
                                    {/if}
                                    </td>
                                    <td>{$vo.qishu}</td>
                                    <td>{$vo.yuqitime}</td>
                                    <td>￥{$vo.beforemoney}</td>
                                    <td>￥{$vo.money}</td>
                                    <td>￥{$vo.aftermoney}</td>
                                    <td>{$vo.paytime}</td>
                                </tr>
                                {/volist}
                            </tbody>
                        </table>

                        <table class="table">
                            <tbody>
                                <tr class=" gray gray-2 step step4" >
                                    <td colspan="2">
                                        <div class="selyuyue" style="padding:0px; margin:0px;">
                                            <button class="btn next" style="background:#dddddd;" type="button" >等待审核</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    {/if}
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </div>
</body>
<script type="text/javascript">
$(function() {
    //获取已报价未确认订单
    var data = {};
    {if $id}
    var id = {$id};
    data["id"] = id;
    {/if}
    $.post("/api/order/getuserorder.do", data, function(ret) {
        if(ret=="null"){
            alert("你没有已报价订单，请先询价！");
            window.location = "/web/index/inquiry";
        }else{
            var json = eval("(" + ret + ")");
            for (key in json) {
                <!-- console.log(key + ":" + json[key]); -->
                $("#" + key).html(json[key]);
            }
            var step = json["step"];
			if(json["stat"]==0){
				$(".step0").remove();
				$(".offer").show();
			}
            if(json["fktype"]==0){
                if(step==0){
                    $(".step0").show();
                    $(".step3,.step4").remove();
                }else if(step==2){
                    window.location = "/web/index/phoneauth.html?id="+json["orderid"];
                }else if(step==3){
                    $(".step3").show();
                    $(".step0,.step4").remove();
                }else if(step==4){
                    if(json["isp"]==0){
                        $(".step4").show();
                        $(".step0,.step3").remove();
                        if((json["fqstat"]>1&&json["fqstat"]<4)){
                            $(".next").css("background-color","#2196f3").html("下一步").addClass("sign");
                        }else if(json["fqstat"]==4){
                            $(".next").css("background-color","#2196f3").html("还款").addClass("payintall");;
                        }
                    }
                }
            }else if(json["fktype"]==1){
                if(json["isp"]){
                    $(".step0").remove();
                }else{
                    $(".install").hide();
                    $(".step0").show();
                }
                $(".step3,.step4,").remove();
            }else{
                $(".step0").show();
            }
        }
    }); 
});
$("body").on("click",".install",function(){
    var id = $("#orderid").html();
    window.location = "/web/index/buy.html?id="+id;
});
$("body").on("click",".sign",function(){
    var id = $("#orderid").html();
    $.post("/api/Signapi/topdf.do", { orderid: id }, function(ret) {
    });
        window.location = "/web/user/sign.html?id="+id;
});

$("body").on("click",".qishu",function(){
    var qishu = "";
    $(".qishu").each(function(){
        if($(this).is(':checked')){
            qishu += qishu?","+$(this).val():$(this).val();
        }
    });
    $("#nowqishu").html(qishu);
})
//还款
$("body").on("click",".payintall",function(){
    var id = $("#orderid").html();
    var qishu = $("#nowqishu").html();
    $.post("/api/webuser/payinstall.do", {id:id,qishu:qishu}, function(ret) {
        window.location = ret;         
    }); 
});
//全款支付
$("body").on("click",".pay",function(){
    var id = $("#orderid").html();
    var qishu = $("#nowqishu").html();
    $.post("/api/webuser/buy.do", {id:id,qishu:qishu}, function(ret) {
        window.location = ret;         
    }); 
});
//创建保单
function createorder() {
    var fromary = $("#orderform").serialize();
    var id = $("#orderid").html();
    fromary += "&id=" + id + "&fktype=0";
    $.post("/api/order/buy.do", fromary, function(ret) {
        alert("分期申请已经提交，请等待审核！");
        window.location.reload();
    });
};
</script>
</html>