<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>layui</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="stylesheet" href="__STATIC__/layui/css/layui.css" media="all" />
<style>body{margin: 10px;}</style>
</head>
<body>

              
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
  <legend>生成订单</legend>
</fieldset>
<form class="layui-form layui-form-pane" action="">
<input type="hidden" value="{$info.id}" name="id">

<table class="layui-table">
  <tbody>
    <tr style="display: none">
		<td style=" width: 120px;"></td>
		<td style=" width: 120px;"></td>
		<td style=" width: 120px;"></td>
		<td style=" width: 120px;"></td>
    </tr>
    <tr height="60">
		<th colspan="4" style="font-size: 24px; font-weight: bold;">
			<label style="width: 50%; float: right;display: block;text-align: right; ">{$offer.car_license}</label>
			<label style="width: 50%; display: block; float:left;">地区：{$info.orderarea}</label>
		</th>
    </tr>
	{if $stat eq 0}
	<tr>
		<th style="font-size: 18px; font-weight: bold;" class="tips">保单单号</th>
		<th colspan="3" style="font-size: 18px; font-weight: bold;">
			<input style="line-height:14px;width:100%;" id="ordernumber"  name="ordernumber" >
		</th>	
	</tr>
	<tr>
		<th style="font-size: 18px; font-weight: bold;" class="tips">生效时间</th>
		<th colspan="3" style="font-size: 18px; font-weight: bold;">
			<input style="line-height:14px;width:100%;" id="awaketime"  name="awaketime" >
		</th>	
	</tr>
	<tr>
		<th style="font-size: 18px; font-weight: bold;" class="tips">保险单扫描件</th>
		<th colspan="3" style="font-size: 18px; font-weight: bold;">
			<input style="line-height:14px;width:60%;" id="orderpic" value="" name="orderpic" >
			         <button type="button" class="layui-btn" id="orderpic_btn">
              <i class="layui-icon">&#xe67c;</i>上传图片
          </button>
		</th>	
	</tr>
	{elseif $stat eq 1}
	<tr>
		<th style="font-size: 18px; font-weight: bold;" class="tips">快递单号</th>
		<th colspan="3" style="font-size: 18px; font-weight: bold;">
			<input style="line-height:14px;width:100%;" id="express_id"  name="express_id" >
		</th>	
	</tr>
	<tr>
		<th style="font-size: 18px; font-weight: bold;" class="tips">快递公司</th>
		<th colspan="3" style="font-size: 18px; font-weight: bold;">
			<input style="line-height:14px;width:100%;" id="express_company"  name="express_company" >
		</th>	
	</tr>
	<tr>
		<th style="font-size: 18px; font-weight: bold;" class="tips">联系电话</th>
		<th colspan="3" style="font-size: 18px; font-weight: bold;">
			<input style="line-height:14px;width:100%;" id="apply_phone" value="{$useraddress.apply_phone}"  name="express_phone" >
		</th>	
	</tr>
	<tr>
		<th style="font-size: 18px; font-weight: bold;" class="tips">快递地址</th>
		<th colspan="3" style="font-size: 18px; font-weight: bold;">
			<input style="line-height:14px;width:100%;" id="address" value="{$useraddress.address}" name="express_address" >
		</th>	
	</tr>
	<tr>
		<th style="font-size: 18px; font-weight: bold;" class="tips">物流扫描件</th>
		<th colspan="3" style="font-size: 18px; font-weight: bold;">
			<input style="line-height:14px;width:60%;" id="expresspic" value="" name="expresspic" >
			         <button type="button" class="layui-btn" id="expresspic_btn">
              <i class="layui-icon">&#xe67c;</i>上传图片
          </button>
		</th>	
	</tr>
	<tr>
		<th style="font-size: 18px; font-weight: bold;" class="tips">其他资料</th>
		<th colspan="3" style="font-size: 18px; font-weight: bold;">
			<input style="line-height:14px;width:60%;" id="otherpic" value="" name="otherpic" >
			         <button type="button" class="layui-btn" id="otherpic_btn">
              <i class="layui-icon">&#xe67c;</i>上传图片
          </button>
		</th>	
	</tr>
	{elseif $stat eq 2}
	<tr>
		<th style="font-size: 18px; font-weight: bold;" class="tips">物流信息</th>
		<th colspan="3" style="font-size: 18px; font-weight: bold;" id="wlinfo">
			
		</th>	
	</tr>

	{/if}

	{if $stat neq 2}
    <tr>
		<td rowspan="4" align="center"><img src="{$offer['headimg']}" style="max-width:100%;max-height:140px;"></td>
		<td class="tips">车主姓名</td>
		<td colspan="2">{$info.realname}</td>
    </tr>
    <tr>
		<td class="tips">身份证</td>
		<td colspan="2">{$info.id_license}</td>
    </tr>
    <tr>
		<td class="tips">保单收货地址</td>
		<td colspan="2">{$info.express_address}</td>
    </tr>
    <tr>
		<td class="tips">保单联系电话</td>
		<td colspan="2">{$info.phone}</td>
    </tr>
    <tr>
		<td class="tips">保单号码</td>
		<td colspan="3">{$info.ordernumber}</td>
    </tr>
    <tr>
		<td class="tips">询价时间</td>
		<td colspan="3">{$offer.addtime}</td>
    </tr>
    <tr>
		<td class="tips">签约时间</td>
		<td colspan="3">{$info.signtime}</td>
    </tr>
	{if $stat > 0}
    <tr>
		<td class="tips">保单编号</td>
		<td colspan="3">{$info.ordernum}</td>
    </tr>
    <tr>
		<td class="tips">生效时间</td>
		<td>{$info.awaketime}</td>
		<td class="tips">到期时间</td>
		<td>{$info.endtime}</td>
    </tr>
		{if $stat >1}
			<tr>
			<td class="tips">快递单号</td>
			<td>{$info.express_id}</td>
			<td class="tips">快递公司</td>
			<td>{$info.express_company}</td>
			</tr>
			<tr>
			<td class="tips">联系电话</td>
			<td>{$info.express_phone}</td>
			<td class="tips">快递地址</td>
			<td>{$info.express_address}</td>
			</tr>
		{/if}
	{/if}
    <tr>
		<td class="tips">车牌照</td>
		<td>{$offer.car_license}</td>
		<td class="tips">投保公司</td>
		<td>{$offer.companyname}</td>
    </tr>
    <tr>
		<td class="tips">投保地区</td>
		<td>{$info.orderarea}</td>
		<td class="tips">交强险</td>
		<td>￥{$offer.jqprice}</td>
    </tr>
    <tr>
		<td class="tips">车船税</td>
		<td>￥{$offer.csprice}</td>
		<td class="tips">商业险</td>
		<td>￥{$offer.syprice}</td>
    </tr>
    <tr>
		<td class="tips">合计金额</td>
		<td>￥{$offer.order_price}</td>
		<td class="tips">到期时间</td>
		<td>{$info.endtime}</td>
    </tr>
    <tr>
		<td class="tips">保单详情</td>
		<td colspan="3">{$info["insurance"]}</td>
    </tr>
    <tr>
		<td colspan="4" align="center">用户身份证件</td>
    </tr>
    <tr>
		<td colspan="2"><img src="{$offer['id_img']}" style="max-width:100%;"></td>
		<td colspan="2"><img src="{$offer['id_img_b']}" style="max-width:100%;"></td>
    </tr>
    <tr>
		<td colspan="4" align="center">机动车行驶证</td>
    </tr>
    <tr>
		<td colspan="2"><img src="{$offer['car_img']}" style="max-width:100%;"></td>
		<td colspan="2"><img src="{$offer['car_img_b']}" style="max-width:100%;"></td>
    </tr>
    {if $info['orderpics']['orderpic']}
    <tr>
		<td colspan="4" align="center">保险单扫描件/物流扫描件</td>
    </tr>
    <tr>
		<td colspan="2"><img src="{$info['orderpics']['orderpic']}" style="max-width:100%;"></td>
		<td colspan="2"><img src="{$info['orderpics']['expresspic']}" style="max-width:100%;"></td>
    </tr>
    {/if}
    {if $info['orderpics']['otherpic']}
    <tr>
		<td colspan="4" align="center">其他资料</td>
    </tr>
    <tr>
		<td colspan="4"><img src="{$info['orderpics']['otherpic']}" style="max-width:100%;"></td>
    </tr>
    {/if}
	{/if}
  </tbody>  
</table>

    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit="" lay-filter="set">立即提交</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </div>
</form>
 
<script type="text/javascript" src="__STATIC__/layui/layui.js"></script>
<script>
layui.use(['form', 'layedit', 'laydate', 'upload'], function(){
    var $ = layui.$,form = layui.form,upload = layui.upload,layer = layui.layer,layedit = layui.layedit,laydate = layui.laydate;
    //自定义验证规则
    form.verify({
    });
	laydate.render({
		elem: '#awaketime',
		type: 'datetime'
	});	
    //监听提交
    form.on('submit(set)', function(data){
      $.post("{:url('selforder/getset')}",data.field,function(res){
        if(res.msg){
          layer.msg(res.msg);
        }else{
            layer.msg("保单编辑成功");
            setTimeout(function(){
              parent.location.reload();
            },800);          
        }
      });
      return false;
    });
	

			
			var uploadInst = upload.render({
				elem: '#orderpic_btn' //绑定元素
				, url: "{:url('apiset/info')}" //上传接口
				, done: function (res) {
					$("#orderpic").val(res.path);
				}
				, error: function () {
					//请求异常回调
				}
			});	
		uploadInst = upload.render({
				elem: '#expresspic_btn' //绑定元素
				, url: "{:url('apiset/info')}" //上传接口
				, done: function (res) {
					$("#expresspic").val(res.path);
				}
				, error: function () {
					//请求异常回调
				}
			});	
		uploadInst = upload.render({
				elem: '#otherpic_btn' //绑定元素
				, url: "{:url('apiset/info')}" //上传接口
				, done: function (res) {
					$("#otherpic").val(res.path);
				}
				, error: function () {
					//请求异常回调
				}
			});	
		{if $stat eq 2}
    $.post("/api/index/getexpress.do", {express_id:{$info.express_id}}, function(ret) {
        var data = eval("(" + ret + ")");
					var html = '';
				if(data.result.result == ""){
					html = "查无该物流信息";
				}else{
					var json = data.result.result.list;
					console.log(json);
					for (var i = 0; i < json.length; i++) {
							html += '<div class="detail"><i class="fa fa-circle"></i><div class="text">'+json[i].status+'</div><div class="eachtime">'+json[i].time+'</div></div>';
					} 
				}
					$("#wlinfo").append(html);
    }); 
	{/if}
});
</script>

</body>
</html>